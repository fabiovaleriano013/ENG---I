{% extends 'base_industria.html' %}

{% block title %}Materias Primas{% endblock %}

{% block content %}

{% for message in messages %}
{% if message.tags == 'success' %}
<div class="alert alert-success alert-dismissible fade show mt-3 mb-0" role="alert" id="message">
    {{ message }}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endif %}
{% endfor %}



<a class="btn btn-outline-success my-3" href="{% url 'create_materia_prima' %}" role="button">
    <i class="fas fa-plus me-1"></i>
    Cadastrar Materia Prima
</a>

<!-- Table -->
<div class="card p-3 mt-3">
    <table class="table table-striped table-bordered nowrap align-middle text-center" id="example">
        <caption>Lista de Materia Prima</caption>
        <thead>
            <tr>
                <th scope="col">Materia Prima</th>
                <th scope="col">Unidade de Medida</th>
                <th scope="col">Grupo</th>
                <th scope="col">Tipo</th>
                <th scope="col">Marca</th>
                <th scope="col">Fabricante</th>
                <th scope="col">Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for materia_prima in materias_primas %}
            <tr>
                <td>
                    {% if materia_prima.nome_materia_prima|length > 7 %}
                    {{ materia_prima.nome_materia_prima|slice:":7" }}...
                    {% else %}
                    {{ materia_prima.nome_materia_prima }}
                    {% endif %}
                </td>
                <td>{{ materia_prima.unidade_medida }}</td>
                <td>{{ materia_prima.grupo }}</td>
                <td>{{ materia_prima.tipo }}</td>
                <td>{{ materia_prima.marca }}</td>
                <td>{{ materia_prima.fabricante }}</td>
                <td>
                    <a href="{% url 'update_materia_prima' id=materia_prima.id %}" class="btn btn-outline-primary btn-sm mb-2 mb-md-0">
                        <i class="fas fa-edit"></i>
                    </a>
                    <a href="#" class="btn btn-outline-danger btn-sm mb-md-0 btn-delete-materia_prima" data-url="{% url 'delete_materia_prima' id=materia_prima.id %}">
                        <i class="fas fa-trash"></i>
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}

{% block javascript %}
<script>
    $(document).ready(function () {
        $(".btn-delete-materia_prima").on("click", function (e) {
            e.preventDefault();
            var link = $(this);
            var confirmation = confirm('Tem certeza que deseja excluir esta materia prima?');

            if (confirmation) {
                var url = link.data('url');
                $.ajax({
                    type: 'POST',
                    url: url,
                    data: {
                        csrfmiddlewaretoken: "{{ csrf_token }}"
                    },
                    success: function (data) {
                        location.reload();
                    },
                    error: function (data) {
                        alert('Erro ao excluir materia prima.');
                    }
                });
            }
        });
    });
</script>
{% endblock %}